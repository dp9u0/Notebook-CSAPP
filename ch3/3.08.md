# 数据结构

## 结构

结构(struct) 是将不同的类型放在一块连续的内存区域中,指向结构的指针就是结构第一个字节的地址

例如如下代码

```c
struct rec
{
    int i;
    int j;
    int a[2];
    int *p;
};

void createRec()
{
    struct rec r;
    int i = 1;
    r.i = 10;
    r.j = 20;
    r.a[0] = 30;
    r.a[1] = 40;
    r.p = &i;
}
```

部分汇编如下:

```s
    movl    $1, -36(%rbp)
    movl    $10, -32(%rbp)   ; rec.i
    movl    $20, -28(%rbp)   ; rec.j
    movl    $30, -24(%rbp)   ; rec.a[0]
    movl    $40, -20(%rbp)   ; rec.a[1]
    leaq    -36(%rbp), %rax  ; &i
    movq    %rax, -16(%rbp)  ; rec.p
```

## 联合

多个共用公用一块区域的内存

```c
// 在小端机器上 double 值为 word1 word0
// 大端机器上 恰好相反 : word0 word1
double uu2double(unsigned word0, unsigned word1)
{
    union {
        double d;
        unsigned u[2];
    } temp;

    temp.u[0] = word0;
    temp.u[1] = word1;
    return temp.d;
}
```

## 数据对齐

内存读取总是以4字节(32位) or 8字节(64位)进行的,如果所有地址都是以4字节或者8字节对齐可以提高内存读取效率

```c
struct S1
{
    int i;
    char c;
    int j;
};

struct S2
{
    int i;
    int j;
    char c;
};
```

以4字节对齐为例 :

```struct S1 s1``` 对齐方式 :

![对齐](./img/3.08.1.png)

```struct S2 s2s[4]``` 其中一个元素的对齐方式 :

![对齐](./img/3.08.2.png)